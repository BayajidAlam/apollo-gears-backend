<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 550">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; fill: #1f2937; }
      .subtitle { font-family: Arial, sans-serif; font-size: 12px; fill: #6b7280; }
      .box-title { font-family: Arial, sans-serif; font-size: 13px; font-weight: bold; fill: white; }
      .box-text { font-family: Arial, sans-serif; font-size: 10px; fill: #333; }
      .arrow { stroke: #374151; stroke-width: 2; fill: none; marker-end: url(#arrow); }
      .arrow-success { stroke: #10b981; stroke-width: 2; fill: none; marker-end: url(#arrow-green); }
      .arrow-error { stroke: #ef4444; stroke-width: 2; fill: none; stroke-dasharray: 5,5; marker-end: url(#arrow-red); }
      .label { font-family: Arial, sans-serif; font-size: 9px; fill: #374151; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10b981"/>
    </marker>
    <marker id="arrow-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="550" fill="#fafafa"/>

  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" class="title">JWT Authentication Flow - Apollo Gears</text>

  <!-- ============ REGISTRATION FLOW ============ -->
  <text x="220" y="60" text-anchor="middle" class="subtitle">Registration Flow</text>

  <!-- Client -->
  <g transform="translate(30, 80)">
    <rect width="100" height="80" rx="8" fill="#e0f2fe" stroke="#0ea5e9" stroke-width="2"/>
    <rect width="100" height="25" rx="8" fill="#0ea5e9"/>
    <text x="50" y="17" text-anchor="middle" class="box-title">CLIENT</text>
    <text x="50" y="45" text-anchor="middle" class="box-text">POST /register</text>
    <text x="50" y="58" text-anchor="middle" class="box-text">{name, email,</text>
    <text x="50" y="70" text-anchor="middle" class="box-text">password, role}</text>
  </g>

  <!-- Zod Validation -->
  <g transform="translate(170, 80)">
    <rect width="90" height="80" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <rect width="90" height="25" rx="8" fill="#f59e0b"/>
    <text x="45" y="17" text-anchor="middle" class="box-title">ZOD</text>
    <text x="45" y="45" text-anchor="middle" class="box-text">Validate</text>
    <text x="45" y="58" text-anchor="middle" class="box-text">Request</text>
    <text x="45" y="70" text-anchor="middle" class="box-text">Body</text>
  </g>

  <!-- Auth Service -->
  <g transform="translate(300, 80)">
    <rect width="100" height="80" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
    <rect width="100" height="25" rx="8" fill="#10b981"/>
    <text x="50" y="17" text-anchor="middle" class="box-title">AUTH SERVICE</text>
    <text x="50" y="45" text-anchor="middle" class="box-text">1. Check email</text>
    <text x="50" y="58" text-anchor="middle" class="box-text">2. Hash password</text>
    <text x="50" y="70" text-anchor="middle" class="box-text">   (bcrypt)</text>
  </g>

  <!-- Database -->
  <g transform="translate(380, 180)">
    <ellipse cx="40" cy="10" rx="35" ry="10" fill="#ec4899"/>
    <rect x="5" y="10" width="70" height="50" fill="#ec4899"/>
    <ellipse cx="40" cy="60" rx="35" ry="10" fill="#be185d"/>
    <text x="40" y="40" text-anchor="middle" class="box-title" font-size="11">PostgreSQL</text>
  </g>

  <!-- Success Response -->
  <g transform="translate(30, 200)">
    <rect width="100" height="60" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
    <text x="50" y="20" text-anchor="middle" class="box-text" font-weight="bold">✓ 201 Created</text>
    <text x="50" y="35" text-anchor="middle" class="box-text">{user data}</text>
    <text x="50" y="50" text-anchor="middle" class="box-text">No password</text>
  </g>

  <!-- Arrows for Registration -->
  <line x1="130" y1="120" x2="165" y2="120" class="arrow"/>
  <line x1="260" y1="120" x2="295" y2="120" class="arrow"/>
  <line x1="400" y1="160" x2="415" y2="175" class="arrow"/>
  <path d="M 350 160 L 350 230 L 135 230" class="arrow-success"/>

  <!-- ============ LOGIN FLOW ============ -->
  <text x="220" y="295" text-anchor="middle" class="subtitle">Login Flow</text>

  <!-- Client Login -->
  <g transform="translate(30, 310)">
    <rect width="100" height="70" rx="8" fill="#e0f2fe" stroke="#0ea5e9" stroke-width="2"/>
    <rect width="100" height="25" rx="8" fill="#0ea5e9"/>
    <text x="50" y="17" text-anchor="middle" class="box-title">CLIENT</text>
    <text x="50" y="45" text-anchor="middle" class="box-text">POST /login</text>
    <text x="50" y="58" text-anchor="middle" class="box-text">{email, password}</text>
  </g>

  <!-- Auth Service Login -->
  <g transform="translate(170, 310)">
    <rect width="110" height="70" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
    <rect width="110" height="25" rx="8" fill="#10b981"/>
    <text x="55" y="17" text-anchor="middle" class="box-title">AUTH SERVICE</text>
    <text x="55" y="45" text-anchor="middle" class="box-text">1. Find user by email</text>
    <text x="55" y="58" text-anchor="middle" class="box-text">2. Compare password</text>
  </g>

  <!-- JWT Generation -->
  <g transform="translate(320, 310)">
    <rect width="100" height="70" rx="8" fill="#ede9fe" stroke="#8b5cf6" stroke-width="2"/>
    <rect width="100" height="25" rx="8" fill="#8b5cf6"/>
    <text x="50" y="17" text-anchor="middle" class="box-title">JWT SERVICE</text>
    <text x="50" y="45" text-anchor="middle" class="box-text">Generate tokens:</text>
    <text x="50" y="58" text-anchor="middle" class="box-text">Access + Refresh</text>
  </g>

  <!-- Login Response -->
  <g transform="translate(30, 420)">
    <rect width="140" height="70" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
    <text x="70" y="18" text-anchor="middle" class="box-text" font-weight="bold">✓ 200 OK + Cookies</text>
    <text x="70" y="35" text-anchor="middle" class="box-text">accessToken (1d)</text>
    <text x="70" y="50" text-anchor="middle" class="box-text">refreshToken (7d)</text>
    <text x="70" y="63" text-anchor="middle" class="box-text">{user data}</text>
  </g>

  <!-- Arrows for Login -->
  <line x1="130" y1="345" x2="165" y2="345" class="arrow"/>
  <line x1="280" y1="345" x2="315" y2="345" class="arrow"/>
  <path d="M 370 380 L 370 455 L 175 455" class="arrow-success"/>

  <!-- ============ PROTECTED ROUTE FLOW ============ -->
  <text x="680" y="60" text-anchor="middle" class="subtitle">Protected Route Access</text>

  <!-- Client Request -->
  <g transform="translate(550, 80)">
    <rect width="100" height="70" rx="8" fill="#e0f2fe" stroke="#0ea5e9" stroke-width="2"/>
    <rect width="100" height="25" rx="8" fill="#0ea5e9"/>
    <text x="50" y="17" text-anchor="middle" class="box-title">CLIENT</text>
    <text x="50" y="42" text-anchor="middle" class="box-text">Authorization:</text>
    <text x="50" y="55" text-anchor="middle" class="box-text">&lt;accessToken&gt;</text>
  </g>

  <!-- Auth Middleware -->
  <g transform="translate(700, 80)">
    <rect width="110" height="70" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <rect width="110" height="25" rx="8" fill="#f59e0b"/>
    <text x="55" y="17" text-anchor="middle" class="box-title">AUTH MW</text>
    <text x="55" y="42" text-anchor="middle" class="box-text">1. Verify JWT</text>
    <text x="55" y="55" text-anchor="middle" class="box-text">2. Check role</text>
  </g>

  <!-- Controller -->
  <g transform="translate(700, 180)">
    <rect width="110" height="50" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
    <rect width="110" height="25" rx="8" fill="#10b981"/>
    <text x="55" y="17" text-anchor="middle" class="box-title">CONTROLLER</text>
    <text x="55" y="42" text-anchor="middle" class="box-text">Process request</text>
  </g>

  <!-- Success -->
  <g transform="translate(550, 180)">
    <rect width="100" height="50" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
    <text x="50" y="22" text-anchor="middle" class="box-text" font-weight="bold">✓ 200 OK</text>
    <text x="50" y="40" text-anchor="middle" class="box-text">{data}</text>
  </g>

  <!-- Unauthorized -->
  <g transform="translate(550, 260)">
    <rect width="100" height="50" rx="8" fill="#fee2e2" stroke="#ef4444" stroke-width="2"/>
    <text x="50" y="22" text-anchor="middle" class="box-text" font-weight="bold" fill="#ef4444">✗ 401</text>
    <text x="50" y="40" text-anchor="middle" class="box-text">Unauthorized</text>
  </g>

  <!-- Arrows for Protected Route -->
  <line x1="650" y1="115" x2="695" y2="115" class="arrow"/>
  <line x1="755" y1="150" x2="755" y2="175" class="arrow-success"/>
  <line x1="700" y1="205" x2="655" y2="205" class="arrow-success"/>
  <path d="M 810 115 L 850 115 L 850 285 L 655 285" class="arrow-error"/>

  <!-- ============ REFRESH TOKEN FLOW ============ -->
  <text x="680" y="340" text-anchor="middle" class="subtitle">Token Refresh Flow</text>

  <!-- Client Refresh -->
  <g transform="translate(550, 360)">
    <rect width="100" height="60" rx="8" fill="#e0f2fe" stroke="#0ea5e9" stroke-width="2"/>
    <rect width="100" height="25" rx="8" fill="#0ea5e9"/>
    <text x="50" y="17" text-anchor="middle" class="box-title">CLIENT</text>
    <text x="50" y="42" text-anchor="middle" class="box-text">Cookie:</text>
    <text x="50" y="55" text-anchor="middle" class="box-text">refreshToken</text>
  </g>

  <!-- JWT Verify -->
  <g transform="translate(700, 360)">
    <rect width="110" height="60" rx="8" fill="#ede9fe" stroke="#8b5cf6" stroke-width="2"/>
    <rect width="110" height="25" rx="8" fill="#8b5cf6"/>
    <text x="55" y="17" text-anchor="middle" class="box-title">JWT SERVICE</text>
    <text x="55" y="42" text-anchor="middle" class="box-text">Verify refresh</text>
    <text x="55" y="55" text-anchor="middle" class="box-text">Issue new access</text>
  </g>

  <!-- New Token -->
  <g transform="translate(550, 460)">
    <rect width="100" height="50" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
    <text x="50" y="20" text-anchor="middle" class="box-text" font-weight="bold">✓ New Token</text>
    <text x="50" y="38" text-anchor="middle" class="box-text">accessToken</text>
  </g>

  <!-- Arrows for Refresh -->
  <line x1="650" y1="390" x2="695" y2="390" class="arrow"/>
  <path d="M 755 420 L 755 485 L 655 485" class="arrow-success"/>

  <!-- Legend -->
  <g transform="translate(30, 505)">
    <rect width="280" height="35" rx="6" fill="white" stroke="#e5e7eb"/>
    <text x="15" y="23" class="box-text" font-weight="bold">Legend:</text>
    <line x1="65" y1="20" x2="95" y2="20" class="arrow"/>
    <text x="100" y="23" class="box-text">Request</text>
    <line x1="145" y1="20" x2="175" y2="20" class="arrow-success"/>
    <text x="180" y="23" class="box-text">Success</text>
    <line x1="225" y1="20" x2="255" y2="20" class="arrow-error"/>
    <text x="260" y="23" class="box-text">Error</text>
  </g>
</svg>
